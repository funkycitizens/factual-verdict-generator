<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
canvas { border: 1px solid black; }
</style>
<style></style></head><body>

Declarație: <select id="decl">
  <option value="#E6383F">Fals</option>
  <option value="#F08283">Parțial fals</option>
  <option value="#373737">Neutru</option>
  <option value="#9FD6D0">Parțial adv.</option>
  <option value="#27B198">Adevărat</option>
</select>;
Link poza: <input name="url-poza" value="https://www141.lunapic.com/editor/working/152570592839857240?2361468011">;</br>
Citat: <textarea name="quote" rows="3" cols="45">E important să ştim cu cine vorbim şi dacă mă uit la tine să ştiu că tu eşti tu.</textarea><br>
filename <input name="filename" value="factual.png"><br>
<button id="render">render</button><br><br>

<canvas id="cnv" width="32" height="32"></canvas><br><br>
<a id="download" download="Canvas.png" href="#">Download</a>

<script src="https://unpkg.com/jquery"></script>
<script>

function render() {
  var width = 960;
  var height = 960;
  var filename = $('[name=filename]').val();
  var decl = $('#decl').val();
  var quote = $('[name=quote]').val();

  var canvas = $("#cnv")[0];
  $(canvas).attr({width: width, height: height});
  var ctx = canvas.getContext("2d");

  ctx.clearRect(0, 0, width, height);

  function r(ctx, x, y, w, h, c) {
    ctx.beginPath();
    ctx.rect(x, y, w, h);
    ctx.strokeStyle = c;
    ctx.stroke();
  }
  r(ctx, 0, 0, 32, 32, "black");
  r(ctx, 4, 4, 16, 16, "red");
  r(ctx, 8, 8, 16, 16, "green");
  r(ctx, 12, 12, 16, 16, "blue");

  ctx.fillStyle = decl;
  ctx.fillRect(0, 0, width, width*12/100);
  ctx.fillRect(0, height-30, width, 30);
  ctx.fillRect(width-420, height-90, width, 90);
  ctx.moveTo(width-420, height-90); 
  ctx.lineTo(width-460, height-30);
  ctx.lineTo(width-420, height-30);
  ctx.fill();

  var paleta = new Image();
  paleta.addEventListener('load', function() {
    ctx.drawImage(paleta, 780, 57) }, false);
  paleta.src = 'paleta.png';

  var poza = new Image();
  poza.addEventListener('load', function() {
    ctx.drawImage(poza, 50, 170, 230, 230) }, false);
  poza.src = $('[name=url-poza]').val();

//spagetti from the internet for a textarea
    function wrapText(context, text, x, y, maxWidth, lineHeight) {
      var words = text.split(' ');
      var line = '';

      for(var n = 0; n < words.length; n++) {
        var testLine = line + words[n] + ' ';
        var metrics = ctx.measureText(testLine);
        var testWidth = metrics.width;
        if (testWidth > maxWidth && n > 0) {
          ctx.fillText(line, x, y);
          line = words[n] + ' ';
          y += lineHeight;
        }
        else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, y);
    }

    var maxWidth = 855;
    var lineHeight = 250;
    var x = 60;
    var y = 445;
    var text = quote;

    ctx.font = 'italic 16pt Calibri';
    ctx.fillStyle = '#333';

    wrapText(ctx, text, x, y, maxWidth, lineHeight);

  var dt = canvas.toDataURL('image/png');
  dt = dt.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');
  dt = dt.replace(/^data:application\/octet-stream/, 'data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=' + $('#download').attr('download'));
  $('#download').attr('href', dt);
  $('#download').attr('download', filename);
}

$('#render').click(render);
</script>
</body></html>
